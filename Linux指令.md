### Linux  ###

---

- 能简单使用 cat，grep，cut 等命令进行一些操作；
- 文件系统相关的原理，inode 和 block 等概念，数据恢复；
- 硬链接与软链接；
- 进程管理相关，僵尸进程与孤儿进程，SIGCHLD 。



#### 常用操作 ####

---







#### 磁盘接口 ####

---

1.IDE

IDE（ATA）全称 Advanced Technology Attachment，接口速度最大为 133MB/s，因为并口线的抗干扰性太差，且排线占用空间较大，不利电脑内部散热，已**逐渐被 SATA 所取代**。



2.SATA

SATA 全称 Serial ATA，也就是使用**串口的 ATA 接口，抗干扰性强，且对数据线的长度要求比 ATA 低很多，支持热插拔等功能**。SATA-II 的接口速度为 300MB/s，而 SATA-III 标准可达到 600MB/s 的传输速度。SATA 的数据线也比 ATA 的细得多，有利于机箱内的空气流通，整理线材也比较方便。



3.SCSI

SCSI 全称是 Small Computer System Interface（小型机系统接口），SCSI 硬盘**广为工作站以及个人电脑以及服务器所使用**，因此会使用较为先进的技术，如碟片转速 15000rpm 的高转速，且传输时 CPU 占用率较低，但是单价也比相同容量的 ATA 及 SATA 硬盘更加昂贵。



4.SAS

SAS（Serial Attached SCSI）是新一代的 SCSI 技术，和 SATA 硬盘相同，都是采取**序列式技术以获得更高的传输速度**，可达到 6Gb/s。此外也通过缩小连接线改善系统内部空间等。



**磁盘的文件名**

Linux 中每个硬件都被当做一个文件，包括磁盘。磁盘以磁盘接口类型进行命名，常见磁盘的文件名如下：

- IDE 磁盘：/dev/hd[a-d]
- SATA/SCSI/SAS 磁盘：/dev/sd[a-p]

其中文件名后面的序号的确定与系统检测到磁盘的顺序有关，而与磁盘所插入的插槽位置无关。



#### 分区表 ####

---



##### 分区表 #####

磁盘分区表主要有两种格式，一种是限制较多的 MBR 分区表，一种是较新且限制较少的 GPT 分区表。



**MBR**

**MBR 中，第一个扇区最重要**，里面有主要开机记录（Master boot record, MBR）及分区表（partition table），其中主要开机记录占 446 bytes，分区表占 64 bytes。

分区表只有 64 bytes，最多只能存储 4 个分区，这 4 个分区为主分区（Primary）和扩展分区（Extended）。其中扩展分区只有一个，它使用其它扇区来记录额外的分区表，因此通过扩展分区可以分出更多分区，这些分区称为逻辑分区。

Linux 也把分区当成文件，分区文件的命名方式为：磁盘文件名 + 编号，例如 /dev/sda1。注意，逻辑分区的编号从 5 开始。



**GPT**

**扇区是磁盘的最小存储单位**，旧磁盘的扇区大小通常为 512 bytes，而最新的磁盘支持 4 k。GPT 为了兼容所有磁盘，在**定义扇区上使用逻辑区块地址**（Logical Block Address, LBA），LBA 默认大小为 512 bytes。

GPT 第 1 个区块记录了主要开机记录（MBR），紧接着是 33 个区块记录分区信息，并把最后的 33 个区块用于对分区信息进行备份。这 33 个区块第一个为 GPT 表头纪录，这个部份纪录了分区表本身的位置与大小和备份分区的位置，同时放置了分区表的校验码 (CRC32)，操作系统可以根据这个校验码来判断 GPT 是否正确。若有错误，可以使用备份分区进行恢复。

GPT 没有扩展分区概念，都是主分区，每个 LBA 可以分 4 个分区，因此总共可以分 4 * 32 = 128 个分区。

MBR 不支持 2.2 TB 以上的硬盘，GPT 则最多支持到 233 TB = 8 ZB。



##### 开机检测程序 #####

1.BIOS

BIOS（Basic Input/Output System，基本输入输出系统），它是一个固件（嵌入在硬件中的软件），BIOS程序存放在 断电后内容不会丢失的只读内存中。



BIOS 是开机的时候计算机执行的第一个程序，这个程序知道可以开机的磁盘，并读取磁盘第一个扇区的主要开机记录（MBR），由主要开机记录（MBR）执行其中的开机管理程序，这个开机管理程序会加载操作系统的核心文件。

主要开机记录（MBR）中的开机管理程序提供以下功能：选单、载入核心文件以及转交其它开机管理程序。转交这个功能可以用来实现多重引导，只需要将另一个操作系统的开机管理程序安装在其它分区的启动扇区上，在启动开机管理程序时，就可以通过选单选择启动当前的操作系统或者转交给其它开机管理程序从而启动另一个操作系统。

<img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/f900f266-a323-42b2-bc43-218fdb8811a8.jpg" style="zoom:67%;" />



安装多重引导，最好先安装 Windows 再安装 Linux。因为安装 Windows 时会覆盖掉主要开机记录（MBR），而 Linux 可以选择将开机管理程序安装在主要开机记录（MBR）或者其它分区的启动扇区，并且可以设置开机管理程序的选单。



2.UEFI

BIOS 不可以读取 GPT 分区表，而 UEFI 可以。



#### 文件系统 ####

---



##### 分区与文件系统 #####

---

对分区进行格式化是为了在分区上建立文件系统。一个分区通常只能格式化为一个文件系统，但是磁盘阵列等技术可以将一个分区格式化为多个文件系统。



##### 组成 #####

---

最主要的几个组成部分如下：

- inode：一个文件占用一个 inode，记录文件的属性，同时记录此文件的内容所在的 block 编号；
- block：记录文件的内容，文件太大时，会占用多个 block。

除此之外还包括：

- superblock：记录文件系统的整体信息，包括 inode 和 block 的总量、使用量、剩余量，以及文件系统的格式与相关信息等；
- block bitmap：记录 block 是否被使用的位图。

<img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/BSD_disk.png" style="zoom: 33%;" />



##### 文件读取 #####

---

对于 Ext2 文件系统，当要读取一个文件的内容时，先在 inode 中查找文件内容所在的所有 block，然后把所有 block 的内容读出来。







**Linux上后台运行**

两种命令：nohup和screen

1.nohup

1）nohup全称是 no hang up （不挂起），用于在系统后台不挂断地运行命令，退出终端也不会影响程序的运行。

2）nohup命令在默认情况下（非重定向），会输出一个叫nohup.out的文件到当前目录下。如果当前目录的nohup.out文件不可写，输出重定向到 $HOME/nohup.out中。

3）默认情况下，若当前用户不退出，由nohup命令生成的子进程其父进程是当前用户的进程。而当用户退出后，父进程变为1。



---

比如使用ssh连接服务器部署的网站后，关闭ssh连接则网站不能访问，重新连接开启服务才能访问，推断是断开ssh连接时程序就被终止了。寻求能够保持程序运行在后台的方法，有nohup和screen。使用nohup可以把程序放到后台运行，且可以查看nohup.out知道程序运行的状态，但使用nohup把程序放到后台后，就再也无法切换到前台了，而screen可以反复使唤。

---



2.screen

linux screen命令用于多重视窗管理程序，此处的视窗，是指一个全屏幕的文字模式画面。



**守护进程**

守护进程是一类在后台运行的特殊进程，用于执行特殊的系统任务。很多守护进程在系统引导的时候启动，并且一直运行直到系统关闭。另一些只在需要的时候启动，完成任务后就自动结束。

守护进程是一个在后台运行且不受任何终端控制的进程，守护进程从一个终端启动，但同一个终端可能被其他人使用，用户不希望其他人在使用该终端的时候接收到该守护进程的任何信息，也不希望其他人影响这个守护进程运行。

创建方法：

1）创建子进程，终止父进程。screen就是这样。

2）在子进程中创建新会话。setsid。